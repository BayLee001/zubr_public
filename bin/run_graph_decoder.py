import os
from shutil import copytree,copy


script_path = os.path.abspath(os.path.dirname(__file__))
#ex_data = os.path.abspath(os.path.join(script_path,"../experiments/technical_documentation/data/c/"))

params = []

description = []

tasks = [
    "setup_data",
    "zubr.wrapper.foma",
    "add_graph_paths",
    "zubr.GraphDecoder",
]

def setup_data(config):
    """Set up the target data for all the different utilties to use"""
    data_dir = os.path.dirname(config.atraining)
    new = os.path.join(config.dir,"orig_data")
    name = config.atraining.split('/')[-1]
    
    if config.dir != data_dir or not os.isdir(new):
        copytree(data_dir,new)
        config.atraining = os.path.join(new,name)
        config.rfile = os.path.join(config.dir,"orig_data/rank_list.txt")

    #if config.base_full_data:
    #basee = "%s_base.e" % config.atraining
    #basef = "%s_base.f" % config.atraining

    basee = "%s_pseudo.e" % config.atraining
    basef = "%s_pseudo.f" % config.atraining
    etrain = "%s.e" % config.atraining
    ftrain = "%s.f" % config.atraining
    copy(basee,etrain)
    copy(basef,ftrain)

    ## copy the rank file
    copied_rank = os.path.join(config.dir,"rank_list.txt")
    copy(config.rfile,copied_rank)

def add_graph_paths(config):
    """Create links to the graphs generated by foma in the previous setp

    :param config: the standard configuration 
    """
    config.graph = os.path.join(config.dir,"graph.att")
